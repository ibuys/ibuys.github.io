I"¸<p>For years now I‚Äôve wanted a simple way to encrypt or decrypt a file in macOS, so this morning I built it. This takes five to ten minutes to setup, and provides the encryption service as a right-click menu item and a pair of folders with folder actions enabled. Here‚Äôs what I did.</p>

<p>First, I installed the command line utility <code class="highlighter-rouge">ccrypt</code> with Homebrew: <code class="highlighter-rouge">brew install ccrypt</code>.</p>

<p>Next, I added a hidden config file containing my secret key in <code class="highlighter-rouge">~/.ccrypt</code> and saved the key to 1Password.</p>

<p>Then, I created two new services in Automator with a single action of ‚ÄúRun Shell Script. The services accept files or folders in Finder, and have the ‚ÄúPass input: ‚Äú setting of the Run Shell Script action set to ‚Äúas arguments‚Äù.  The  Encrypt File service looks like this:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">EXTEN</span><span class="o">=</span><span class="s2">"cpt"</span>

<span class="k">for </span>FILENAME <span class="k">in</span> <span class="s2">"</span><span class="nv">$@</span><span class="s2">"</span>
<span class="k">do
	if </span><span class="nb">test</span> <span class="s2">"</span><span class="k">${</span><span class="nv">FILENAME</span><span class="p">#*</span><span class="nv">$EXTEN</span><span class="k">}</span><span class="s2">"</span> <span class="o">!=</span> <span class="s2">"</span><span class="nv">$FILENAME</span><span class="s2">"</span>
	<span class="k">then
		</span><span class="nb">echo</span> <span class="s2">"Already encrypted."</span>
	<span class="k">else</span>
		/usr/local/bin/ccencrypt <span class="nt">-k</span> ~/.ccrypt <span class="nv">$FILENAME</span>
	<span class="k">fi

done</span>

</code></pre></div></div>

<p>And the Decrypt File service is only slightly different:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">EXTEN</span><span class="o">=</span><span class="s2">"cpt"</span>

<span class="k">for </span>FILENAME <span class="k">in</span> <span class="s2">"</span><span class="nv">$@</span><span class="s2">"</span>
<span class="k">do
	if </span><span class="nb">test</span> <span class="s2">"</span><span class="k">${</span><span class="nv">FILENAME</span><span class="p">#*</span><span class="nv">$EXTEN</span><span class="k">}</span><span class="s2">"</span> <span class="o">!=</span> <span class="s2">"</span><span class="nv">$FILENAME</span><span class="s2">"</span>
	<span class="k">then</span>
		/usr/local/bin/ccdecrypt <span class="nt">-k</span> ~/.ccrypt <span class="nv">$FILENAME</span>
	<span class="k">else
		</span><span class="nb">echo</span> <span class="s2">"Already decrypted."</span>
	<span class="k">fi

done</span>

</code></pre></div></div>

<p>The first line in the script sets the EXTEN variable to ‚Äúcpt‚Äù, which is what the <code class="highlighter-rouge">ccrypt</code> executable adds as a file extension when it encrypts a file. Next I setup a for loop to cycle through all of the selected files, and then do a test to see if the file being looked at already has the ‚Äúcpt‚Äù extension or not. This is especially important when setting up a folder action, because when the file is encrypted it will drop in as a new file in the folder, which will then attempt to encrypt it again unless this check is preset.</p>

<p>After saving these two Automator services you should be able to right click on any file in the Finder and encrypt it, and then the same again to decrypt. I‚Äôve also added the two scripts as folder actions to two folders name ‚ÄúEncrypted‚Äù and ‚ÄúDecrypted‚Äù, so if I‚Äôd rather move and encrypt the files, I can just drag and drop them on the folders.</p>

<p>All in all, this gives me a little more peace of mind about saving files in iCloud and syncing them between my two Macs. They won‚Äôt be available in iOS, but for the types of files I need on both machines, that‚Äôs not a problem.</p>
:ET